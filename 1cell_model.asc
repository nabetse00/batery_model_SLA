Version 4
SHEET 1 1908 680
WIRE 784 -256 464 -256
WIRE 928 -256 784 -256
WIRE 1104 -256 992 -256
WIRE 1296 -256 1184 -256
WIRE 1296 -208 1296 -256
WIRE 1392 -208 1296 -208
WIRE 464 -160 464 -256
WIRE 784 -128 784 -256
WIRE 880 -128 784 -128
WIRE 944 -128 880 -128
WIRE 1104 -128 1008 -128
WIRE 1296 -128 1296 -208
WIRE 1296 -128 1184 -128
WIRE -368 0 -560 0
WIRE -192 0 -368 0
WIRE -48 0 -192 0
WIRE 0 0 -48 0
WIRE 112 0 0 0
WIRE 304 0 192 0
WIRE 880 32 880 -128
WIRE 896 32 880 32
WIRE 1040 32 896 32
WIRE -560 48 -560 0
WIRE -368 48 -368 0
WIRE 464 64 464 -80
WIRE -192 96 -192 0
WIRE 1040 96 1040 32
WIRE -48 112 -48 0
WIRE 1392 128 1392 -208
WIRE 896 144 896 32
WIRE -368 192 -368 112
WIRE 1040 224 1040 160
WIRE 464 368 464 144
WIRE 672 368 464 368
WIRE 896 368 896 208
WIRE 896 368 672 368
WIRE 1040 368 1040 304
WIRE 1040 368 896 368
WIRE 1344 368 1040 368
WIRE 1392 368 1392 208
WIRE 1392 368 1344 368
WIRE -560 416 -560 112
WIRE -368 416 -368 272
WIRE -368 416 -560 416
WIRE -192 416 -192 176
WIRE -192 416 -368 416
WIRE -48 416 -48 176
WIRE -48 416 -192 416
WIRE 304 416 304 0
WIRE 304 416 -48 416
WIRE -560 432 -560 416
WIRE 672 448 672 368
FLAG -560 432 0
FLAG 672 448 0
FLAG 0 0 SOC
FLAG 1392 -208 in+
FLAG 1344 368 in-
SYMBOL diode -544 112 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName Db1
SYMATTR Value Db
SYMBOL diode -384 48 R0
SYMATTR InstName Db2
SYMATTR Value Db
SYMBOL cap -64 112 R0
SYMATTR InstName Csoc
SYMATTR Value {3600*{CAPAH}/(-{Rsoc}*log(1-100/{Rsoc}))}
SYMBOL res -208 80 R0
SYMATTR InstName Rsoc
SYMATTR Value {Rsoc}
SYMBOL voltage -368 176 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vsoc
SYMATTR Value 110
SYMBOL bv 464 48 R0
SYMATTR InstName B1
SYMATTR Value V=vcell(V(SOC))
SYMBOL voltage 464 -176 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 0
SYMBOL diode 928 -240 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName Ddischg
SYMATTR Value Db
SYMBOL diode 1008 -144 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName Dchg
SYMATTR Value Db
SYMBOL diode 912 208 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName Db3
SYMATTR Value Db
SYMBOL res 1200 -272 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rdischg
SYMATTR Value 6m
SYMBOL res 1200 -144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rchg
SYMATTR Value 200m
SYMBOL diode 1024 96 R0
SYMATTR InstName Db4
SYMATTR Value Db
SYMBOL voltage 1040 208 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 2.39
SYMBOL bi 192 0 R90
WINDOW 0 -32 40 VBottom 2
WINDOW 3 32 40 VTop 2
SYMATTR InstName B2
SYMATTR Value I=I(V1)
SYMBOL current 1392 208 R180
WINDOW 0 24 80 Left 2
WINDOW 3 24 0 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName I1
SYMATTR Value PULSE(-1 1 1p 1p 1p 15m 30m 1)
TEXT -648 -296 Left 2 !.model Db D(Ron=1m Roff=1G Vfwd=1m  epsilon=1u revepsilon=1u N=0.01)
TEXT -648 -192 Left 2 !.func vcell(x)  a*log(b*x) + c*d**(e*x) + f*x +g
TEXT -648 -264 Left 2 ;a*np.log(b*x) + c*d**(e*x) + f*x +g)
TEXT -648 -232 Left 2 !.param a=1.33e-01 b=8.79e-01 c=8.99e-07 d=8.95e-01 e=-1.02 f=-1.10e-03 g=1.68
TEXT -640 -384 Left 2 !.tran 0 30m 0
TEXT -648 -152 Left 2 !.ic V(SOC)={soc}
TEXT -24 -152 Left 2 !.param capah=2.78u
TEXT -24 -112 Left 2 !.param Rsoc=1Meg
TEXT -24 -184 Left 2 !.param soc=1m
